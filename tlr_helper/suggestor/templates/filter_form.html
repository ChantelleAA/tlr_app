{% extends "base.html" %}
{% block content %}
<div class="container my-4">
  <div class="card shadow-sm rounded-4 p-4" style="max-width: 720px;margin:auto;">

    <a href="{% url 'route_select' %}" class="btn btn-link mb-3">
      &larr; Choose a different path
    </a>

    <h4 class="mb-3">Refine Your Search</h4>

    <form method="post">
      {% csrf_token %}

      <!-- Common fields -->
      <div class="mb-3">
        <label for="id_class_level">{{ form.class_level.label }}</label>
        <select name="class_level" id="id_class_level"
                class="form-select"
                hx-get="{% url 'ajax_load_subjects' %}"
                hx-target="#subject-field"
                hx-trigger="change">
          {% for cl in form.class_level.field.queryset %}
            <option value="{{ cl.pk }}"
            {% if form.class_level.value == cl.pk|stringformat:"s" %}selected{% endif %}>
              {{ cl.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Subject: this will be replaced by AJAX -->
      <div class="mb-3" id="subject-field">
        {{ form.subject.label_tag }} {{ form.subject }}
      </div>

      <!-- Term -->
      <div class="mb-3">
        <label for="id_term">{{ form.term.label }}</label>
        <select name="term" id="id_term"
                class="form-select"
                hx-get="{% url 'ajax_load_strands' %}"
                hx-target="#strand-field"
                hx-trigger="change from:closest form">
          {% for value, label in form.term.field.choices %}
            <option value="{{ value }}"
            {% if form.term.value|stringformat:"s" == value|stringformat:"s" %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Conditionally render strand for curriculum route -->
      {% if route == "curriculum" %}
        <div class="mb-3" id="strand-field">
          {{ form.strand.label_tag }} {{ form.strand }}
        </div>
      

        <div class="mb-3">{{ form.substrand.label_tag }} {{ form.substrand }}</div>
      {% elif route == "key_area" %}
        <div class="mb-3">{{ form.key_area.label_tag }} {{ form.key_area }}</div>
      {% elif route == "competency" %}
        <div class="mb-3">{{ form.competency.label_tag }} {{ form.competency }}</div>
      {% elif route == "theme" %}
        <div class="mb-3">{{ form.theme.label_tag }} {{ form.theme }}</div>
      {% elif route == "goal" %}
        <div class="mb-3">{{ form.goal.label_tag }} {{ form.goal }}</div>
      {% elif route == "resource" %}
        <div class="mb-3">{{ form.resource_type.label_tag }} {{ form.resource_type }}</div>
      {% endif %}

      <!-- General filters -->
      <div class="mb-3">{{ form.intended_use.label_tag }} {{ form.intended_use }}</div>
      <div class="mb-3">{{ form.time_available.label_tag }} {{ form.time_available }}</div>
      <div class="mb-3">{{ form.class_size.label_tag }} {{ form.class_size }}</div>
      <div class="mb-3">{{ form.bloom_level.label_tag }} {{ form.bloom_level }}</div>
      <div class="mb-3">{{ form.budget_band.label_tag }} {{ form.budget_band }}</div>
      <div class="mb-3">{{ form.materials_available.label_tag }} {{ form.materials_available }}</div>

      <!-- Special needs: now a selectable field -->
      <div class="mb-3">{{ form.learner_type.label_tag }} {{ form.learner_type }}</div>
      <div class="mb-3">{{ form.preferred_format.label_tag }} {{ form.preferred_format }}</div>
      <div class="mb-3">{{ form.classroom_setup.label_tag }} {{ form.classroom_setup }}</div>
      <div class="mb-3">{{ form.outcome.label_tag }} {{ form.outcome }}</div>

      <button class="btn btn-nile btn-lg w-100 mt-3">
        <i class="bi bi-search"></i> Find&nbsp;TLRs
      </button>
    </form>
  </div>
</div>
{% endblock %}
