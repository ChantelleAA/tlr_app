{% load static %}
{% for tlr in suggestions %}
  <div class="card mb-4 shadow-sm rounded-4 p-4">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="text-primary">{{ tlr.title }}</h5>
      <small class="text-muted">{{ tlr.subject }} | {{ tlr.class_level }}</small>
    </div>

    <p class="mt-2">{{ tlr.brief_description|truncatewords:30 }}</p>

    {% if tlr.steps_to_make %}
      <details class="mt-3">
        <summary class="fw-semibold">ğŸ› ï¸ Steps to Make</summary>
        <p class="mt-2">{{ tlr.steps_to_make|linebreaks }}</p>
      </details>
    {% endif %}

    {% if tlr.tips_for_use %}
      <details class="mt-2">
        <summary class="fw-semibold">ğŸ“ Tips for Classroom Use</summary>
        <p class="mt-2">{{ tlr.tips_for_use|linebreaks }}</p>
      </details>
    {% endif %}

    {% if tlr.outcome %}
      <p class="mt-3"><strong>ğŸŒŸ Outcome:</strong> {{ tlr.outcome }}</p>
    {% endif %}

    {% if tlr.content_standard or tlr.indicators.all %}
      <details class="mt-3">
        <summary class="fw-semibold">ğŸ“˜ Curriculum Links</summary>
        {% if tlr.content_standard %}
          <p class="mt-2"><strong>Standard:</strong> {{ tlr.content_standard }}</p>
        {% endif %}
        {% if tlr.indicators.all %}
          <p><strong>Indicators:</strong><br>
            {{ tlr.indicators.all|join:", " }}</p>
        {% endif %}
      </details>
    {% endif %}

    <div class="row row-cols-2 row-cols-md-3 g-2 mt-3">
      <div><span class="badge bg-dark border">âŒ› {{ tlr.get_time_needed_display }}</span></div>
      <div><span class="badge bg-dark border">ğŸ’° {{ tlr.get_budget_band_display }}</span></div>
      <div><span class="badge bg-dark border">ğŸŒŸ {{ tlr.get_bloom_level_display }}</span></div>
      <div><span class="badge bg-dark border">ğŸ“ˆ {{ tlr.download_count|default:"0" }} downloads</span></div>
      {% if tlr.intended_use %}
        <div><span class="badge bg-dark border">ğŸ—‚ï¸ {{ tlr.get_intended_use_display }}</span></div>
      {% endif %}
    </div>

    {% if tlr.materials.all %}
      <p class="mt-3"><strong>ğŸ“Œ Materials:</strong>
        {{ tlr.materials.all|join:", " }}</p>
    {% endif %}

    <div class="d-flex flex-wrap gap-1 mt-3">
      {% for tag in tlr.themes.all %}
        <span class="badge bg-success-subtle text-success border">ğŸŒ± {{ tag }}</span>
      {% endfor %}
      {% for tag in tlr.key_learning_areas.all %}
        <span class="badge bg-primary-subtle text-primary border">ğŸ“š {{ tag }}</span>
      {% endfor %}
      {% for tag in tlr.competencies.all %}
        <span class="badge bg-warning-subtle text-dark border">ğŸ§  {{ tag }}</span>
      {% endfor %}
      {% for tag in tlr.resource_types.all %}
        <span class="badge bg-secondary-subtle text-dark border">ğŸ§©ï¸ {{ tag }}</span>
      {% endfor %}
      {% for tag in tlr.special_needs.all %}
        <span class="badge bg-danger-subtle text-danger border">â™¿ {{ tag }}</span>
      {% endfor %}
      {% for tag in tlr.learning_styles.all %}
        <span class="badge bg-info-subtle text-info border">ğŸ¨ {{ tag }}</span>
      {% endfor %}
    </div>

{% if tlr.images.all or tlr.videos.all %}
  <div class="mt-3">
    {% if tlr.images.all %}
      <div class="mb-3">
        <strong>ğŸ–¼ï¸ Images:</strong><br>
        <div class="row g-2 mt-1">
          {% for img in tlr.images.all %}
            <div class="col-6 col-md-4">
              <img src="{{ img.image.url }}" alt="{{ img.caption }}" class="img-fluid rounded shadow-sm">
              {% if img.caption %}
                <small class="d-block text-muted mt-1">{{ img.caption }}</small>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if tlr.videos.all %}
      <div class="mb-3">
        <strong>ğŸ¬ Videos:</strong><br>
        <div class="ratio ratio-16x9">
          {% for vid in tlr.videos.all %}
            <iframe src="{{ vid.url }}" title="{{ vid.caption }}" allowfullscreen class="mb-2"></iframe>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>
{% endif %}


    <div class="text-end mt-4">
      <a href="{% url 'download_tlr' tlr.pk %}" class="btn btn-nile">
        <i class="bi bi-download"></i> Download TLR
      </a>
    </div>
  </div>
{% empty %}
  <div class="alert alert-info text-center">No TLRs matched your search. Try adjusting your filters.</div>
{% endfor %}
